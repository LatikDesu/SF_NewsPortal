{% extends 'base.html' %}
{% load static %}

{% block title %} {{ title }} {% endblock title %}

{% block content %}

    <section class="single-block-wrapper section-padding">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-md-12 col-sm-12 col-xs-12">
                    <div class="single-post">
                        <div class="post-header mb-5 text-center">
                            <div class="meta-cat">
                                <a class="post-category font-extra text-color text-uppercase font-sm letter-spacing-1"
                                   href="#">
                                    {% for category in post.postcategory_set.all %}
                                        {{ category.category }}
                                    {% endfor %}
                                </a>
                            </div>
                            <h2 class="post-title mt-2">
                                {{ post.title }}
                            </h2>

                            <div class="post-meta">
                                <span class="text-uppercase font-sm letter-spacing-1 mr-3">{{ post.author }}</span>
                                <span class="text-uppercase font-sm letter-spacing-1">{{ post.time|date:"M d, Y" }}</span>
                            </div>
                            <div class="post-featured-image mt-5">
                                <img src="{{ post.poster.url }}" class="img-fluid w-50" alt="featured-image">
                            </div>
                        </div>
                        <div class="post-body">
                            <div class="entry-content">
                                {{ post.description }}
                            </div>

                            <div
                                    class="tags-share-box center-box d-flex text-center justify-content-between border-top border-bottom py-3">

                                <span class="single-comment-o"><i
                                        class="fa fa-comment-o"></i> {{ post.comment_set.all|length }} comments </span>

                                <div class="post-share">
                                    <span class="count-number-like">{{ post.rating|floatformat }}</span>
                                    <a class="penci-post-like single-like-button"><i class="ti-heart"></i></a>
                                </div>

                                <div class="list-posts-share">
                                    <a target="_blank" rel="nofollow" href="#"><i class="ti-facebook"></i></a>
                                    <a target="_blank" rel="nofollow" href="#"><i class="ti-pinterest"></i></a>
                                    <a target="_blank" rel="nofollow" href="#"><i class="ti-linkedin"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div class="post-author d-flex my-5">
                        <div class="author-img">
                            <img alt="" src="{{ author.image.url }}" class="avatar avatar-100 photo" width="100"
                                 height="100">
                        </div>

                        <div class="author-content pl-4">
                            <h4 class="mb-3"><a href="#" title="" rel="author"
                                                class="text-capitalize">{{ author.username }}</a>
                            </h4>
                            <p>{{ author.about }}</p>

                            <a target="_blank" class="author-social" href="#">
                                <i class="fa-brands fa-square-gitlab fa-l mr-2"></i></a>
                            <a target="_blank" class="author-social" href="#">
                                <i class="fa-brands fa-vk fa-m mr-2"></i></a>
                            <a target="_blank" class="author-social" href="#">
                                <i class="fa-brands fa-youtube fa-m mr-2"></i></a>
                            <a target="_blank" class="author-social" href="#">
                                <i class="fa-brands fa-telegram fa-m mr-2"></i></a>
                            <a target="_blank" class="author-social" href="#">
                                <i class="fa-brands fa-square-hacker-news fa-m mr-2"></i></a>
                        </div>
                    </div>
                    {#                    <nav class="post-pagination clearfix border-top border-bottom py-4">#}
                    {#                        <div class="prev-post">#}
                    {#                            <a href="blog-single.html">#}
                    {#                                <span class="text-uppercase font-sm letter-spacing">Next</span>#}
                    {#                                <h4 class="mt-3"> Intel’s new smart glasses actually look good</h4>#}
                    {#                            </a>#}
                    {#                        </div>#}
                    {#                        <div class="next-post">#}
                    {#                            <a href="blog-single.html">#}
                    {#                                <span class="text-uppercase font-sm letter-spacing">Previous</span>#}
                    {#                                <h4 class="mt-3">Free Two-Hour Delivery From Whole Foods</h4>#}
                    {#                            </a>#}
                    {#                        </div>#}
                    {#                    </nav>#}
                    {#                    <div class="related-posts-block mt-5">#}
                    {#                        <h3 class="news-title mb-4 text-center">#}
                    {#                            You May Also Like#}
                    {#                        </h3>#}
                    {#                        <div class="row">#}
                    {#                            <div class="col-lg-4 col-md-4 col-sm-6">#}
                    {#                                <div class="post-block-wrapper mb-4 mb-lg-0">#}
                    {#                                    <a href="blog-single.html">#}
                    {#                                        <img class="img-fluid" src="images/fashion/img-1.jpg" alt="post-thumbnail"/>#}
                    {#                                    </a>#}
                    {#                                    <div class="post-content mt-3">#}
                    {#                                        <h5>#}
                    {#                                            <a href="blog-single.html">Intel’s new smart glasses actually look good</a>#}
                    {#                                        </h5>#}
                    {#                                    </div>#}
                    {#                                </div>#}
                    {#                            </div>#}
                    {#                            <div class="col-lg-4 col-md-4 col-sm-6">#}
                    {#                                <div class="post-block-wrapper mb-4 mb-lg-0">#}
                    {#                                    <a href="blog-single.html">#}
                    {#                                        <img class="img-fluid" src="images/fashion/img-2.jpg" alt="post-thumbnail"/>#}
                    {#                                    </a>#}
                    {#                                    <div class="post-content mt-3">#}
                    {#                                        <h5>#}
                    {#                                            <a href="blog-single.html">Free Two-Hour Delivery From Whole Foods</a>#}
                    {#                                        </h5>#}
                    {#                                    </div>#}
                    {#                                </div>#}
                    {#                            </div>#}
                    {#                            <div class="col-lg-4 col-md-4 col-sm-6">#}
                    {#                                <div class="post-block-wrapper">#}
                    {#                                    <a href="blog-single.html">#}
                    {#                                        <img class="img-fluid" src="images/fashion/img-3.jpg" alt="post-thumbnail"/>#}
                    {#                                    </a>#}
                    {#                                    <div class="post-content mt-3">#}
                    {#                                        <h5>#}
                    {#                                            <a href="blog-single.html">Snow and Freezing Rain in Paris Forces the</a>#}
                    {#                                        </h5>#}
                    {#                                    </div>#}
                    {#                                </div>#}
                    {#                            </div>#}
                    {#                        </div>#}
                    {#                    </div>#}

                    <div class="comment-area my-5">
                        <h3 class="mb-4 text-center"> Комментарии </h3>
                        {% for comment in post.get_comments %}
                            <div class="comment-area-box media">
                                {% if comment.user.image %}
                                    <img src="{{ comment.user.image.url }}"
                                         class="img-fluid float-left mr-3 mt-2">
                                {% else %}
                                    <img src="{% static 'images/default_avatar.jpg' %}"
                                         class="img-fluid float-left mr-3 mt-2">
                                {% endif %}

                                <div class="media-body ml-4">
                                    <h4 class="mb-0">{{ comment.user }} </h4>
                                    <span class="date-comm font-sm text-capitalize text-color"><i
                                            class="ti-time mr-2"></i>{{ comment.time|date:"M d, Y" }} </span>

                                    <div class="comment-content mt-3">
                                        <p>{{ comment.text }}</p>
                                    </div>
                                    <div class="comment-meta mt-4 mt-lg-0 mt-md-0">
                                        <a href="#comment-form"
                                           onclick="addComment('{{ comment.user }}', '{{ comment.id }}')"
                                           class="text-underline ">Ответить</a>


                                        {% for comment in comment.comment_set.all %}
                                            <div class="media mt-5 editContent">
                                                <a class="pr-3" href="#">
                                                    {% if comment.user.image %}
                                                        <img src="{{ comment.user.image.url }}"
                                                             class="img-fluid float-left w-50 h-50">
                                                    {% else %}
                                                        <img src="{% static 'images/default_avatar.jpg' %}"
                                                             class="img-fluid float-left w-50 h-50">
                                                    {% endif %}
                                                </a>
                                                <div class="media-body">
                                                    <h5 class="mt-0 editContent">{{ comment.user }}</h5>
                                                    <p class="mt-2 editContent">{{ comment.text }}</p>
                                                </div>
                                            </div>
                                        {% endfor %}

                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    {% if user.is_authenticated %}
                        <form action="{% url 'news:add_comment' post.id %}" method="post"
                              class="comment-form mb-5 gray-bg p-5" id="comment-form">
                            {% csrf_token %}
                            <input type="hidden" name="parent" id="comment-parent" value="">
                            <h3 class="mb-4 text-center">Оставить комментарий</h3>
                            <div class="row">
                                <div class="col-lg-12">
                                                    <textarea class="form-control mb-3" name="text" id="comment"
                                                              cols="30" rows="5"
                                                              placeholder="Comment"></textarea>
                                </div>
                            </div>
                            <input class="btn btn-primary" type="submit" name="submit-contact" id="submit_contact"
                                   value="Отправить">
                        </form>
                    {% else %}
                        <h3 class="mb-4 text-center">Хотите оставить комментарий?</h3>
                        <div class="tags-share-box center-box d-flex text-center justify-content-lg-around border-top border-bottom py-3">
                            <a class="btn btn-primary" href="#" role="button">Войти</a>
                            <a class="btn btn-primary" href="#" role="button">Зарегистрироваться</a>
                        </div>
                    {% endif %}

                </div>
                {% include 'include/sidebar.html' %}
            </div>
        </div>
    </section>
    <script>
        function addComment(name, id) {
            document.getElementById("comment-parent").value = id;
            document.getElementById("comment").innerText = `${name}, `
        }
    </script>
{% endblock content %}

